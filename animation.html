<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Particle Animation</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0a0f 0%, #1a1a2e 50%, #000000 100%);
            overflow: hidden;
            position: relative;
        }

        /* Particle Animation Canvas */
        .particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
        }

        /* Website mockup that forms from particles */
        .website-mockup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 280px;
            z-index: 75;
            opacity: 0;
        }

        .mockup-browser {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 30px 100px rgba(102, 126, 234, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .mockup-header {
            height: 50px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .mockup-dots {
            display: flex;
            gap: 8px;
        }

        .mockup-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .dot-red { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
        .dot-yellow { background: linear-gradient(135deg, #ffd93d, #ffcd02); }
        .dot-green { background: linear-gradient(135deg, #6bcf7f, #4dabf7); }

        .mockup-url {
            margin-left: 25px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 25px;
            padding: 8px 20px;
            font-size: 13px;
            color: #495057;
            flex: 1;
            max-width: 250px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .mockup-content {
            padding: 25px;
            height: calc(100% - 76px);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .mockup-nav {
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .mockup-hero {
            height: 100px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.3);
        }

        .mockup-sections {
            display: flex;
            gap: 15px;
            height: 80px;
            flex: 1;
        }

        .mockup-section {
            flex: 1;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(168, 237, 234, 0.2);
        }

        .mockup-footer {
            height: 35px;
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(210, 153, 194, 0.2);
        }

        /* Enhanced Particle styles */
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            transition: all 0.1s ease;
        }

        .particle.small {
            width: 3px;
            height: 3px;
        }

        .particle.medium {
            width: 5px;
            height: 5px;
        }

        .particle.large {
            width: 7px;
            height: 7px;
        }

        .particle.header { 
            background: radial-gradient(circle, #f8f9fa 0%, #e9ecef 100%);
            box-shadow: 0 0 15px rgba(248, 249, 250, 0.8);
        }
        
        .particle.nav { 
            background: radial-gradient(circle, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.9);
        }
        
        .particle.hero { 
            background: radial-gradient(circle, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 0 25px rgba(245, 87, 108, 0.9);
        }
        
        .particle.section { 
            background: radial-gradient(circle, #a8edea 0%, #fed6e3 100%);
            box-shadow: 0 0 18px rgba(168, 237, 234, 0.8);
        }
        
        .particle.footer { 
            background: radial-gradient(circle, #d299c2 0%, #fef9d7 100%);
            box-shadow: 0 0 15px rgba(210, 153, 194, 0.8);
        }

        /* Ambient particles */
        .ambient-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .website-mockup {
                width: 350px;
                height: 250px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="particle-canvas" id="particleCanvas"></div>
  <div class="website-mockup" id="websiteMockup">
   <div class="mockup-browser">
    <div class="mockup-header">
     <div class="mockup-dots">
      <div class="mockup-dot dot-red"></div>
      <div class="mockup-dot dot-yellow"></div>
      <div class="mockup-dot dot-green"></div>
     </div>
     <div class="mockup-url" id="mockupUrl">
      business-theme.com
     </div>
    </div>
    <div class="mockup-content">
     <div class="mockup-nav"></div>
     <div class="mockup-hero"></div>
     <div class="mockup-sections">
      <div class="mockup-section"></div>
      <div class="mockup-section"></div>
      <div class="mockup-section"></div>
     </div>
     <div class="mockup-footer"></div>
    </div>
   </div>
  </div><!-- Theme indicator -->
  <div style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 25px; padding: 12px 24px; color: white; font-weight: 600; z-index: 100; border: 1px solid rgba(255,255,255,0.2);"><span id="themeIndicator">Business Theme</span>
  </div>
  <script>
        const defaultConfig = {
            background_color: "#0a0a0f",
            accent_color: "#1a1a2e",
            primary_particle_color: "#667eea",
            secondary_particle_color: "#f093fb",
            tertiary_particle_color: "#a8edea"
        };

        let config = { ...defaultConfig };

        async function onConfigChange(newConfig) {
            config = { ...config, ...newConfig };
            
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const accentColor = config.accent_color || defaultConfig.accent_color;
            
            document.body.style.background = `radial-gradient(ellipse at center, ${backgroundColor} 0%, ${accentColor} 50%, #000000 100%)`;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ accent_color: value });
                        }
                    },
                    {
                        get: () => config.primary_particle_color || defaultConfig.primary_particle_color,
                        set: (value) => {
                            config.primary_particle_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ primary_particle_color: value });
                        }
                    },
                    {
                        get: () => config.secondary_particle_color || defaultConfig.secondary_particle_color,
                        set: (value) => {
                            config.secondary_particle_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ secondary_particle_color: value });
                        }
                    },
                    {
                        get: () => config.tertiary_particle_color || defaultConfig.tertiary_particle_color,
                        set: (value) => {
                            config.tertiary_particle_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ tertiary_particle_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map();
        }

        // Enhanced Particle Animation System with 5 Themes
        class ParticleSystem {
            constructor() {
                this.particles = [];
                this.ambientParticles = [];
                this.canvas = document.getElementById('particleCanvas');
                this.mockup = document.getElementById('websiteMockup');
                this.themeIndicator = document.getElementById('themeIndicator');
                this.mockupUrl = document.getElementById('mockupUrl');
                this.animationId = null;
                this.phase = 'gathering';
                this.phaseTimer = 0;
                this.cycleDuration = 8000; // 8 seconds per theme
                this.currentTheme = 0;
                
                // 5 Different UI Themes
                this.themes = [
                    {
                        name: 'Business Theme',
                        url: 'business-pro.com',
                        colors: {
                            header: '#2c3e50',
                            nav: '#3498db',
                            hero: '#e74c3c',
                            section: '#95a5a6',
                            footer: '#34495e'
                        },
                        pattern: 'corporate', // straight lines, organized
                        particleCount: { header: 30, nav: 40, hero: 55, section: 20, footer: 15 }
                    },
                    {
                        name: 'Creative Theme',
                        url: 'creative-studio.com',
                        colors: {
                            header: '#9b59b6',
                            nav: '#e67e22',
                            hero: '#f39c12',
                            section: '#1abc9c',
                            footer: '#e91e63'
                        },
                        pattern: 'artistic', // curved paths, creative flow
                        particleCount: { header: 40, nav: 50, hero: 70, section: 30, footer: 25 }
                    },
                    {
                        name: 'Tech Theme',
                        url: 'tech-innovation.com',
                        colors: {
                            header: '#0f4c75',
                            nav: '#00d2ff',
                            hero: '#3742fa',
                            section: '#2ed573',
                            footer: '#1e3799'
                        },
                        pattern: 'digital', // grid-like, precise
                        particleCount: { header: 35, nav: 45, hero: 65, section: 25, footer: 20 }
                    },
                    {
                        name: 'Nature Theme',
                        url: 'eco-friendly.com',
                        colors: {
                            header: '#27ae60',
                            nav: '#2ecc71',
                            hero: '#f39c12',
                            section: '#16a085',
                            footer: '#229954'
                        },
                        pattern: 'organic', // flowing, natural curves
                        particleCount: { header: 45, nav: 55, hero: 75, section: 35, footer: 30 }
                    },
                    {
                        name: 'Minimal Theme',
                        url: 'minimal-design.com',
                        colors: {
                            header: '#2c2c2c',
                            nav: '#4a4a4a',
                            hero: '#666666',
                            section: '#888888',
                            footer: '#333333'
                        },
                        pattern: 'minimal', // clean, simple paths
                        particleCount: { header: 25, nav: 30, hero: 40, section: 15, footer: 12 }
                    }
                ];
                
                this.mockupElements = [
                    { selector: '.mockup-header', type: 'header', size: 'small' },
                    { selector: '.mockup-nav', type: 'nav', size: 'medium' },
                    { selector: '.mockup-hero', type: 'hero', size: 'large' },
                    { selector: '.mockup-section', type: 'section', size: 'medium' },
                    { selector: '.mockup-footer', type: 'footer', size: 'small' }
                ];
                
                this.createAmbientParticles();
                this.startAnimation();
            }

            createAmbientParticles() {
                // Create floating ambient particles
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'ambient-particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    
                    this.canvas.appendChild(particle);
                    this.ambientParticles.push(particle);
                    
                    this.animateAmbientParticle(particle);
                }
            }

            animateAmbientParticle(particle) {
                const duration = 15000 + Math.random() * 10000;
                const startX = parseFloat(particle.style.left);
                const startY = parseFloat(particle.style.top);
                const endX = Math.random() * window.innerWidth;
                const endY = Math.random() * window.innerHeight;
                
                let startTime = null;
                
                const animate = (currentTime) => {
                    if (!startTime) startTime = currentTime;
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeProgress = this.easeInOutSine(progress);
                    const currentX = startX + (endX - startX) * easeProgress;
                    const currentY = startY + (endY - startY) * easeProgress;
                    
                    particle.style.left = currentX + 'px';
                    particle.style.top = currentY + 'px';
                    particle.style.opacity = 0.3 + Math.sin(elapsed * 0.003) * 0.2;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        this.animateAmbientParticle(particle);
                    }
                };
                
                requestAnimationFrame(animate);
            }

            createParticle(targetElement, type, size) {
                const particle = document.createElement('div');
                particle.className = `particle ${type} ${size}`;
                
                const theme = this.themes[this.currentTheme];
                const color = theme.colors[type];
                
                // Apply theme color and glow effect
                particle.style.background = `radial-gradient(circle, ${color} 0%, ${color}aa 100%)`;
                particle.style.boxShadow = `0 0 15px ${color}80, 0 0 25px ${color}60`;
                
                // Pattern-based starting positions
                let startX, startY;
                const margin = 60;
                
                if (theme.pattern === 'corporate') {
                    // Organized, grid-like entry
                    const side = Math.floor(Math.random() * 4);
                    switch(side) {
                        case 0: startX = Math.random() * window.innerWidth; startY = -margin; break;
                        case 1: startX = window.innerWidth + margin; startY = Math.random() * window.innerHeight; break;
                        case 2: startX = Math.random() * window.innerWidth; startY = window.innerHeight + margin; break;
                        case 3: startX = -margin; startY = Math.random() * window.innerHeight; break;
                    }
                } else if (theme.pattern === 'artistic') {
                    // Creative, spiral entry
                    const angle = Math.random() * Math.PI * 2;
                    const radius = 800 + Math.random() * 200;
                    const centerX = window.innerWidth / 2;
                    const centerY = window.innerHeight / 2;
                    startX = centerX + Math.cos(angle) * radius;
                    startY = centerY + Math.sin(angle) * radius;
                } else if (theme.pattern === 'digital') {
                    // Grid-based, precise entry
                    const gridSize = 8;
                    const side = Math.floor(Math.random() * 4);
                    if (side < 2) {
                        startX = Math.floor(Math.random() * gridSize) * (window.innerWidth / gridSize);
                        startY = side === 0 ? -margin : window.innerHeight + margin;
                    } else {
                        startX = side === 2 ? -margin : window.innerWidth + margin;
                        startY = Math.floor(Math.random() * gridSize) * (window.innerHeight / gridSize);
                    }
                } else if (theme.pattern === 'organic') {
                    // Natural, flowing entry from multiple points
                    const side = Math.floor(Math.random() * 6);
                    const wave = Math.sin(Date.now() * 0.001) * 100;
                    switch(side) {
                        case 0: startX = Math.random() * window.innerWidth; startY = -margin + wave; break;
                        case 1: startX = window.innerWidth + margin; startY = Math.random() * window.innerHeight + wave; break;
                        case 2: startX = Math.random() * window.innerWidth; startY = window.innerHeight + margin + wave; break;
                        case 3: startX = -margin; startY = Math.random() * window.innerHeight + wave; break;
                        case 4: startX = window.innerWidth * 0.2; startY = -margin; break;
                        case 5: startX = window.innerWidth * 0.8; startY = window.innerHeight + margin; break;
                    }
                } else { // minimal
                    // Clean, simple entry
                    const side = Math.floor(Math.random() * 4);
                    switch(side) {
                        case 0: startX = window.innerWidth / 2 + (Math.random() - 0.5) * 200; startY = -margin; break;
                        case 1: startX = window.innerWidth + margin; startY = window.innerHeight / 2 + (Math.random() - 0.5) * 200; break;
                        case 2: startX = window.innerWidth / 2 + (Math.random() - 0.5) * 200; startY = window.innerHeight + margin; break;
                        case 3: startX = -margin; startY = window.innerHeight / 2 + (Math.random() - 0.5) * 200; break;
                    }
                }
                
                particle.style.left = startX + 'px';
                particle.style.top = startY + 'px';
                
                // Target position with some randomness
                const rect = targetElement.getBoundingClientRect();
                const targetX = rect.left + Math.random() * rect.width;
                const targetY = rect.top + Math.random() * rect.height;
                
                particle.targetX = targetX;
                particle.targetY = targetY;
                particle.startX = startX;
                particle.startY = startY;
                particle.progress = 0;
                particle.speed = 0.018 + Math.random() * 0.025;
                particle.type = type;
                particle.delay = Math.random() * 800;
                particle.theme = theme.pattern;
                
                this.canvas.appendChild(particle);
                return particle;
            }

            updateParticles() {
                const currentTime = Date.now();
                
                this.particles.forEach((particle, index) => {
                    if (currentTime < particle.startTime + particle.delay) return;
                    
                    if (this.phase === 'gathering') {
                        particle.progress += particle.speed;
                        if (particle.progress >= 1) particle.progress = 1;
                        
                        const easeProgress = this.easeInOutCubic(particle.progress);
                        let currentX = particle.startX + (particle.targetX - particle.startX) * easeProgress;
                        let currentY = particle.startY + (particle.targetY - particle.startY) * easeProgress;
                        
                        // Theme-specific movement patterns
                        if (particle.theme === 'corporate') {
                            // Straight, professional movement
                            // No additional effects
                        } else if (particle.theme === 'artistic') {
                            // Creative spiral approach
                            const spiralRadius = (1 - easeProgress) * 30;
                            const spiralAngle = currentTime * 0.008 + index * 0.5;
                            currentX += Math.cos(spiralAngle) * spiralRadius;
                            currentY += Math.sin(spiralAngle) * spiralRadius;
                        } else if (particle.theme === 'digital') {
                            // Grid-snapped movement with glitch effect
                            const glitchIntensity = (1 - easeProgress) * 5;
                            if (Math.random() < 0.1) {
                                currentX += (Math.random() - 0.5) * glitchIntensity;
                                currentY += (Math.random() - 0.5) * glitchIntensity;
                            }
                        } else if (particle.theme === 'organic') {
                            // Natural, flowing movement
                            const waveRadius = (1 - easeProgress) * 25;
                            const waveAngle = currentTime * 0.003 + index * 0.3;
                            currentX += Math.sin(waveAngle) * waveRadius;
                            currentY += Math.cos(waveAngle * 1.3) * waveRadius * 0.7;
                        } else { // minimal
                            // Clean, simple movement with subtle easing
                            const subtleRadius = (1 - easeProgress) * 8;
                            const subtleAngle = currentTime * 0.002 + index;
                            currentX += Math.cos(subtleAngle) * subtleRadius;
                            currentY += Math.sin(subtleAngle) * subtleRadius;
                        }
                        
                        particle.style.left = currentX + 'px';
                        particle.style.top = currentY + 'px';
                        particle.style.opacity = easeProgress * 0.9;
                        
                    } else if (this.phase === 'dissolving') {
                        particle.progress += particle.speed * 2.2;
                        if (particle.progress >= 1) particle.progress = 1;
                        
                        const easeProgress = this.easeInCubic(particle.progress);
                        const centerX = window.innerWidth / 2;
                        const centerY = window.innerHeight / 2;
                        
                        // Theme-specific dissolution patterns
                        let angle, distance;
                        
                        if (particle.theme === 'corporate') {
                            // Organized, directional exit
                            angle = Math.atan2(particle.targetY - centerY, particle.targetX - centerX);
                            distance = 900 * easeProgress;
                        } else if (particle.theme === 'artistic') {
                            // Creative explosion with curves
                            angle = Math.atan2(particle.targetY - centerY, particle.targetX - centerX) + 
                                   Math.sin(easeProgress * Math.PI * 2) * 0.8;
                            distance = (700 + Math.random() * 500) * easeProgress;
                        } else if (particle.theme === 'digital') {
                            // Sharp, angular exit
                            const snapAngle = Math.round(Math.atan2(particle.targetY - centerY, particle.targetX - centerX) / (Math.PI/4)) * (Math.PI/4);
                            angle = snapAngle;
                            distance = 1000 * easeProgress;
                        } else if (particle.theme === 'organic') {
                            // Natural, flowing exit
                            angle = Math.atan2(particle.targetY - centerY, particle.targetX - centerX) + 
                                   Math.sin(easeProgress * Math.PI * 3) * 0.4;
                            distance = (600 + Math.sin(easeProgress * Math.PI) * 300) * easeProgress;
                        } else { // minimal
                            // Clean, simple exit
                            angle = Math.atan2(particle.targetY - centerY, particle.targetX - centerX);
                            distance = 800 * easeProgress;
                        }
                        
                        const currentX = particle.targetX + Math.cos(angle) * distance;
                        const currentY = particle.targetY + Math.sin(angle) * distance;
                        
                        particle.style.left = currentX + 'px';
                        particle.style.top = currentY + 'px';
                        particle.style.opacity = (1 - easeProgress) * 0.9;
                    }
                });
            }

            easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            easeInCubic(t) {
                return t * t * t;
            }

            easeInOutSine(t) {
                return -(Math.cos(Math.PI * t) - 1) / 2;
            }

            startCycle() {
                // Clear existing particles
                this.particles.forEach(particle => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                });
                this.particles = [];
                
                const theme = this.themes[this.currentTheme];
                const startTime = Date.now();
                
                // Update theme indicator and URL
                this.themeIndicator.textContent = theme.name;
                this.mockupUrl.textContent = theme.url;
                
                // Update mockup colors to match theme
                this.updateMockupColors(theme);
                
                // Create new particles with theme-specific counts
                this.mockupElements.forEach((element, elementIndex) => {
                    const targets = document.querySelectorAll(element.selector);
                    const particleCount = theme.particleCount[element.type];
                    
                    targets.forEach((target, targetIndex) => {
                        for (let i = 0; i < particleCount; i++) {
                            const particle = this.createParticle(target, element.type, element.size);
                            particle.startTime = startTime + (elementIndex * 100) + (i * 5);
                            this.particles.push(particle);
                        }
                    });
                });
                
                this.phase = 'gathering';
                this.phaseTimer = 0;
                this.mockup.style.opacity = '0';
                this.mockup.style.transform = 'translate(-50%, -50%) scale(0.8)';
            }

            updateMockupColors(theme) {
                const header = document.querySelector('.mockup-header');
                const nav = document.querySelector('.mockup-nav');
                const hero = document.querySelector('.mockup-hero');
                const sections = document.querySelectorAll('.mockup-section');
                const footer = document.querySelector('.mockup-footer');
                
                if (header) header.style.background = `linear-gradient(135deg, ${theme.colors.header} 0%, ${theme.colors.header}dd 100%)`;
                if (nav) nav.style.background = `linear-gradient(135deg, ${theme.colors.nav} 0%, ${theme.colors.nav}dd 100%)`;
                if (hero) hero.style.background = `linear-gradient(135deg, ${theme.colors.hero} 0%, ${theme.colors.hero}dd 100%)`;
                if (footer) footer.style.background = `linear-gradient(135deg, ${theme.colors.footer} 0%, ${theme.colors.footer}dd 100%)`;
                
                sections.forEach(section => {
                    section.style.background = `linear-gradient(135deg, ${theme.colors.section} 0%, ${theme.colors.section}dd 100%)`;
                });
            }

            animate() {
                this.phaseTimer += 16;
                
                if (this.phase === 'gathering') {
                    this.updateParticles();
                    
                    const allReached = this.particles.every(p => p.progress >= 1);
                    if (allReached || this.phaseTimer > 2800) {
                        this.phase = 'forming';
                        this.phaseTimer = 0;
                        
                        // Smooth mockup appearance
                        this.mockup.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                        this.mockup.style.opacity = '1';
                        this.mockup.style.transform = 'translate(-50%, -50%) scale(1)';
                    }
                    
                } else if (this.phase === 'forming') {
                    if (this.phaseTimer > 1800) {
                        this.phase = 'dissolving';
                        this.phaseTimer = 0;
                        
                        // Smooth mockup disappearance
                        this.mockup.style.transition = 'all 0.6s ease-in';
                        this.mockup.style.opacity = '0';
                        this.mockup.style.transform = 'translate(-50%, -50%) scale(1.1)';
                        
                        // Reset particle progress for dissolving
                        this.particles.forEach(particle => {
                            particle.progress = 0;
                            particle.startTime = Date.now();
                        });
                    }
                    
                } else if (this.phase === 'dissolving') {
                    this.updateParticles();
                    
                    if (this.phaseTimer > 1500) {
                        // Move to next theme
                        this.currentTheme = (this.currentTheme + 1) % this.themes.length;
                        
                        // Brief pause before next theme
                        setTimeout(() => this.startCycle(), 200);
                    }
                }
                
                this.animationId = requestAnimationFrame(() => this.animate());
            }

            startAnimation() {
                this.startCycle();
                this.animate();
            }

            destroy() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                [...this.particles, ...this.ambientParticles].forEach(particle => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                });
            }
        }

        // Initialize everything
        let particleSystem;

        function initializeAnimation() {
            if (particleSystem) {
                particleSystem.destroy();
            }
            particleSystem = new ParticleSystem();
        }

        // Initialize SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Start animation when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initializeAnimation, 300);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (particleSystem) {
                setTimeout(initializeAnimation, 100);
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e22876d582068e',t:'MTc2MzA3NzY4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>